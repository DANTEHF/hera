extends ../layout

block content
  if info
    div(class='alert alert-info')
      p= info
  if error
    div(class='alert alert-danger')
      p= error

  div(class='row')
    div(class='col-md-2')
      ul(class='nav nav-pills nav-stacked' id='admin-tab')
        li(class='active')
          a(href='#user-pane' data-toggle='pill') 操作员管理
        li
          a(href='#project-pane' data-toggle='pill') 项目配置
    div(class='col-md-10')
      div(class='tab-content')
        div(class='tab-pane active' id='user-pane')
          each user in users
            div(class='panel panel-default')
              div(class='panel-heading')
                h4(class='panel-title')
                  a(data-toggle='collapse' data-parent='#user-accordion' href='#' + user._id)= user.username
                  a(class='pull-right' data-toggle='collapse' data-parent='#user-accordion' href='#' + user._id + '-modify') 修改
                  a(class='pull-right user-delete-button' href='#' data-id=user._id data-username=user.username) 删除
              div(id=user._id class='panel-collapse collapse out')
                div(class='panel-body')
                  p= user.username
                  p= user.profile.name
                  each project in user.projects
                    p= project
              div(id=user._id + '-modify' class='panel-collapse collapse out')
                div(class='panel-body')
                  form(class='form-horizontal user-modify-form' method='post' data-id=user._id)
                    div(class='form-group')
                      div(class='col-sm-3')
                        div(class='input-group')
                          span(class='input-group-addon') 用户名
                          input(name='username' class='form-control' value=user.username)
                      div(class='col-sm-3')
                        div(class='input-group')
                          span(class='input-group-addon') 密码
                          input(name='password' class='form-control' type='password')
                      div(class='col-sm-3')
                        div(class='input-group')
                          span(class='input-group-addon') 姓名
                          input(name='name' class='form-control' value=user.profile.name)
                    div(class='form-group')
                      div(class='col-sm-12')
                        div(class='btn-group' data-toggle='buttons')
                          each project in projects
                            - var isIn = user.projects.indexOf(project._id) != -1
                            label(class='btn btn-default ' + (isIn ? 'active' : ''))
                              input(name='project' type='checkbox' value=project.id checked=isIn)
                              | #{project.name}
                    div(class='form-group')
                      div(class='col-sm-offset-10 col-sm-2')
                        button(class='btn btn-default') 保存修改
          div(class='collapse' id='user-add-form')
            form(class='form-horizontal' method='post' action='/user')
              div(class='form-group')
                div(class='col-sm-3')
                  div(class='input-group')
                    span(class='input-group-addon') 用户名
                    input(name='username' class='form-control')
                div(class='col-sm-3')
                  div(class='input-group')
                    span(class='input-group-addon') 密码
                    input(name='password' class='form-control' type='password')
                div(class='col-sm-3')
                  div(class='input-group')
                    span(class='input-group-addon') 姓名
                    input(name='name' class='form-control')
              div(class='form-group')
                div(class='col-sm-12')
                  div(class='btn-group' data-toggle='buttons')
                    each project in projects
                      label(class='btn btn-default')
                        input(name='project' type='checkbox' value=project.id)
                        | #{project.name}
              div(class='form-group')
                div(class='col-sm-offset-10 col-sm-2')
                  button(class='btn btn-primary pull-right') 确认增加
          div(style='margin-bottom: 1em;')
            button(class='btn btn-primary pull-right'
            data-toggle='collapse'
            data-target='#user-add-form'
            id='user-add-button') 增加

        div(class='tab-pane' id='project-pane')
          each project in projects
            div(class='panel panel-default')
              div(class='panel-heading')
                h4(class='panel-title')
                  a(data-toggle='collapse' data-parent='#project-accordion' href='#' + project._id)
                    span= ' ' + (project.name || '')
                    span= ' ' + (project.fullName || '')
                    //span= ' ' + (project.address || '')
                    //span= ' ' + (project.contact || '')
                    //span= ' ' + (project.phone || '')
                  a(class='pull-right'
                  data-toggle='collapse'
                  data-parent='#project-accordion'
                  href='#' + project._id + '-modify') 修改
                  a(class='pull-right project-delete-button'
                  data-id=project._id
                  data-project=project.name
                  href='#') 删除
              div(id=project._id, class='panel-collapse collapse out')
                div(class='panel-body')
                  p 显示信息页面
                  p 来往记录
                  p 最新消息
                  p 等等信息
              div(id=project._id + '-modify', class='panel-collapse collapse out')
                div(class='panel-body')
                  form(class='form-horizontal project-modify-form' data-id=project._id method='post')
                    div(class='form-group')
                      label(class='control-label col-sm-2') 简称
                      div(class='col-sm-2')
                        input(class='form-control' name='name' type='text' value=project.name)
                      label(class='control-label col-sm-2') 全称
                      div(class='col-sm-6')
                        input(class='form-control' name='fullName' type='text' value=project.fullName)
                    div(class='form-group')
                      label(class='control-label col-sm-2') 公司电话
                      div(class='col-sm-2')
                        input(class='form-control' name='tel' type='text' value=project.tel)
                      label(class='control-label col-sm-2') 地址
                      div(class='col-sm-6')
                        input(class='form-control' name='address' type='text' value=project.address)
                    div(class='contact-group' data-length=project.contacts.length)
                      each contact in project.contacts
                        div(class='form-group')
                          label(class='control-label col-sm-2') 联系人
                          div(class='col-sm-2')
                            input(class='form-control' name='contact.name' type='text' value=contact.name)
                          label(class='control-label col-sm-2') 联系人电话
                          div(class='col-sm-6')
                            div(class='input-group')
                              input(class='form-control' name='contact.phone' type='text' value=contact.phone)
                              span(class='input-group-btn')
                                a(class='btn btn-default contact-plus-button')
                                  span(class='glyphicon glyphicon-plus')
                              span(class='input-group-btn')
                                a(class='btn btn-default contact-minus-button')
                                  span(class='glyphicon glyphicon-minus')
                    div(class='form-group')
                      label(class='control-label col-sm-2') 备注
                      div(class='col-sm-10')
                        textarea(class='form-control' name='comments' type='text' value=project.comments)
                    div(class='form-group')
                      div(class='col-sm-offset-10 col-sm-2')
                        button(class='btn btn-default btn-primary') 保存修改
          div(class='collapse' id='project-add-form')
            form(class='form-horizontal' method='post' action='/project')
              div(class='form-group')
                label(class='control-label col-sm-2') 简称
                div(class='col-sm-2')
                  input(class='form-control' name='name' type='text')
                label(class='control-label col-sm-2') 全称
                div(class='col-sm-6')
                  input(class='form-control' name='fullName' type='text')
              div(class='form-group')
                label(class='control-label col-sm-2') 公司电话
                div(class='col-sm-2')
                  input(class='form-control' name='tel' type='text')
                label(class='control-label col-sm-2') 地址
                div(class='col-sm-6')
                  input(class='form-control' name='address' type='text')
              div(class='contact-group' data-length=1)
                div(class='form-group')
                  label(class='control-label col-sm-2') 联系人
                  div(class='col-sm-2')
                    input(class='form-control' name='contact.name' type='text')
                  label(class='control-label col-sm-2') 联系人电话
                  div(class='col-sm-6')
                    div(class='input-group')
                      input(class='form-control' name='contact.phone' type='text')
                      span(class='input-group-btn')
                        a(class='btn btn-default contact-plus-button')
                          span(class='glyphicon glyphicon-plus')
                      span(class='input-group-btn')
                        a(class='btn btn-default contact-minus-button')
                          span(class='glyphicon glyphicon-minus')
              div(class='form-group')
                label(class='control-label col-sm-2') 备注
                div(class='col-sm-10')
                  textarea(class='form-control' name='comments')
              div(class='form-group')
                div(class='col-sm-offset-10 col-sm-2')
                  button(class='btn btn-primary pull-right') 确认增加
          div(style='margin-bottom: 1em;')
            button(class='btn btn-primary pull-right'
            data-toggle='collapse'
            data-target='#project-add-form'
            id='project-add-button') 增加
